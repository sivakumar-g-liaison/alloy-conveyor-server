// Common Bundler Tasks
// ==================================================
//
// ==================================================
// ==================================================
// ==           DO NOT EDIT THIS FILE              ==
// ==================================================
// ==================================================
//
// Please avoid editing this file as deploy scripts depend 
// on conventions established herein. For project specific 
// behavior please follow the conventions documented in 
// README.md and implement in ../bundler_project.gradle
//   (Please vet ideas for change with architecture)


def installPath = file("$rootDir/install").getCanonicalPath()

// http://www.gradle.org/docs/current/userguide/application_plugin.html
apply plugin:'war'



task distTar(type: Tar, description:"Creates build distribution tarball", group: "Production Bundler") {
    from 'install'
	compression = Compression.GZIP
}


// TODO - should these go in the root build.gradle?
distTar.dependsOn('stageJRE')
distTar.dependsOn('stageTomcat')
distTar.dependsOn('copyWarToInstall')


// cleanup task for the installer bundle staginf folder
// =======================================================================
task cleanBundleStaging(description: "Cleans the bundler staging folder", group: "Production Bundler") << {
	out.println('Cleaning Install Bundle staging folder...' + installPath)
    ant.delete( 
        dir:"$installPath", 
        includes:'**/*', 
        includeemptydirs:true, 
        deleteonexit:true, 
        performGCOnFailedDelete:true
    )
}

task cleanAll(description: "Cleans the bundler staging folder", dependsOn:['clean','cleanBundleStaging'])
